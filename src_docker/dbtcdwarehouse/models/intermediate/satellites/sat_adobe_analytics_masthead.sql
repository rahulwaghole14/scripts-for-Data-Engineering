{{ config(
    materialized='incremental',
    tags = ['vault_adobe'],
    partition_by={
      "field": "LOAD_DATE",
      "data_type": "timestamp",
      "granularity": "day"
    }
) }}
{%- set yaml_metadata -%}
depends_on: "vlt_stg_adobe_analytics__hits"
source_model: "vlt_stg_adobe_analytics__hits"
src_pk: "ADOBE_HASH"
src_hashdiff:
  source_column: "ADOBE_HASHDIFF"
  alias: "HASHDIFF"
src_payload:
  - "ADOBE_KEY"
  - "DATE_TIME"
  - "DUPLICATE_PURCHASE"
  - "EVENT_LIST"
  - "FIRST_HIT_PAGE_URL"
  - "FIRST_HIT_PAGENAME"
  - "FIRST_HIT_REF_DOMAIN"
  - "FIRST_HIT_REF_TYPE"
  - "FIRST_HIT_REFERRER"
  - "FIRST_HIT_TIME_GMT"
  - "GEO_CITY"
  - "GEO_COUNTRY"
  - "GEO_REGION"
  - "HITID_HIGH"
  - "HITID_LOW"
  - "LAST_HIT_TIME_GMT"
  - "MCVISID"
  - "MOBLIE_ID"
  - "MONTHLY_VISITOR"
  - "NEW_VISIT"
  - "PAGE_URL"
  - "PAGENAME"
  - "POST_CUST_HIT_TIME_GMT"
  - "POST_CUST_VISID"
  - "POST_EF_ID"
  - "POST_EVAR1"
  - "POST_EVAR2"
  - "POST_EVAR3"
  - "POST_EVAR4"
  - "POST_EVAR11"
  - "POST_EVAR14"
  - "POST_EVAR23"
  - "POST_EVAR25"
  - "POST_EVAR28"
  - "POST_EVAR31"
  - "POST_EVAR73"
  - "POST_EVAR84"
  - "POST_EVAR91"
  - "POST_EVAR95"
  - "POST_EVAR96"
  - "POST_EVAR106"
  - "POST_EVAR143"
  - "POST_EVAR163"
  - "POST_EVENT_LIST"
  - "POST_PAGE_EVENT"
  - "POST_PAGENAME"
  - "POST_PAGENAME_NO_URL"
  - "POST_PRODUCT_LIST"
  - "POST_PROP1"
  - "POST_PROP2"
  - "POST_PROP3"
  - "POST_PROP4"
  - "POST_PROP8"
  - "POST_PROP11"
  - "POST_PROP14"
  - "POST_PROP25"
  - "POST_PROP28"
  - "POST_PROP31"
  - "POST_PROP47"
  - "POST_PROP54"
  - "POST_PROP55"
  - "POST_PROP56"
  - "POST_PROP61"
  - "POST_PROP64"
  - "POST_USER_SERVER"
  - "POST_VISID_HIGH"
  - "POST_VISID_LOW"
  - "POST_VISID_TYPE"
  - "PROP1"
  - "PROP2"
  - "PROP3"
  - "PROP4"
  - "PROP11"
  - "PROP14"
  - "PROP25"
  - "PROP28"
  - "PROP31"
  - "PROP47"
  - "PROP54"
  - "PROP56"
  - "PROP61"
  - "PROP64"
  - "PURCHASE_ID"
  - "QUARTERLY_VISITOR"
  - "REF_DOMAIN"
  - "REF_TYPE"
  - "REFERRER"
  - "VISID_HIGH"
  - "VISID_LOW"
  - "VISID_NEW"
  - "VISID_TIMESTAMP"
  - "VISID_TYPE"
  - "VISIT_KEYWORDS"
  - "VISIT_NUM"
  - "VISIT_PAGE_NUM"
  - "VISIT_REF_DOMAIN"
  - "VISIT_REF_TYPE"
  - "VISIT_REFERRER"
  - "VISIT_SEARCH_ENGINE"
  - "VISIT_START_PAGE_URL"
  - "VISIT_START_PAGENAME"
  - "VISIT_START_TIME_GMT"
  - "WEEKLY_VISITOR"
  - "TABLE_SUFFIX_VALUE"
  - "TABLE_SUFFIX_TIME"

src_eff: "EFFECTIVE_FROM"
src_ldts: "LOAD_DATE"
src_source: "RECORD_SOURCE"
{%- endset -%}
{% set metadata_dict = fromyaml(yaml_metadata) %}
{{ automate_dv.sat(src_pk=metadata_dict["src_pk"],
                   src_hashdiff=metadata_dict["src_hashdiff"],
                   src_payload=metadata_dict["src_payload"],
                   src_eff=metadata_dict["src_eff"],
                   src_ldts=metadata_dict["src_ldts"],
                   src_source=metadata_dict["src_source"],
                   source_model=metadata_dict["source_model"])   }}
