{{
  config(
    tags=['piano'],
    materialized='table',
    on_schema_change='sync_all_columns'
  )
}}

WITH vxsub AS (

    SELECT
        Subscription_ID,
        Summary,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',Create_date), 'Pacific/Auckland') AS Create_date,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',Start_date), 'Pacific/Auckland') AS Start_date,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',End_date), 'Pacific/Auckland') AS End_date,
        Days_subscribed,
        Subscription_status,
        Upgrade_status,
        Trial_status,
        Trial_period_end_date,
        Trial_price,
        Regular_price,
        Auto_renew,
        Auto_renew_disablement_date,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',Last_active_date), 'Pacific/Auckland') AS Last_active_date,
        Logins_last_30_days,
        Sessions_last_30_days,
        Pageviews_last_30_days,
        Billing_period,
        Total_charged,
        Charge_count,
        Total_refunded,
        Payment_source,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',Last_billing_date), 'Pacific/Auckland') AS Last_billing_date,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',Next_billing_date), 'Pacific/Auckland') AS Next_billing_date,
        Renewed,
        Currently_in_grace_period,
        Grace_period_start_date,
        Grace_period_extended_to,
        User_ID__UID_,
        User_email,
        First_name,
        Last_name,
        DATE(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S %z',Access_expiration_date), 'Pacific/Auckland') AS Access_expiration_date,
        Resource_ID__RID_,
        Resource_name,
        Term_ID,
        Term_name,
        Term_type,
        Template_ID,
        Template_name,
        Offer_ID,
        Offer_name,
        Experience_ID,
        Experience_name,
        Campaign_codes,
        Promo_code,
        Conversion_city,
        Conversion_state,
        Conversion_country,
        Device,
        URL,
        Cleaned_URL,
        UTM_parameters,
        Name__first_and_last_,
        Company_name,
        Address_1,
        Address_2,
        Address_city,
        Address_state,
        Address_country,
        Postal_code,
        Phone,
        PSC_subscriber_number,
        Tax,
        Tax_base,
        Tax_rate,
        Tax_country,
        Tax_state_province,
        Billing_postal_code,
        Shared_subscriptions,
        Migrated_to_Piano,
        Migrated_date,
        Created_via_upgrade,
        Upgrade_from___subscription_ID,
        Period_name,
        Access_period,
        Period_count,
        report_type,

        app_id,
        app_name,
        DATE(TIMESTAMP(record_load_dts), 'Pacific/Auckland') AS record_load_dts,

    FROM {{ source('piano', 'piano__vxsubscriptionlog') }}

)

SELECT *
FROM vxsub
